import*as e from"/docs/assets/codemirror.min.js";import*as t from"/docs/assets/lu5-console.min.js";import*as n from"https://unpkg.com/lu5-wasm@latest/dist/lu5-wasm-lib.min.js";var o={43:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=r(n(784)),a=s(n(196)),l=n(386),d=n(129),u=l.HighlightStyle.define([{tag:l.tags.keyword,color:"#551b93",fontStyle:"bold"},{tag:l.tags.comment,color:"#8575bf",fontStyle:"italic"},{tag:l.tags.literal,color:"#561074"},{tag:l.tags.string,color:"#551b93"},{tag:l.tags.function(l.tags.variableName),color:"#AA36EF"},{tag:l.tags.variable,color:"#111"}]);let h=new l.Compartment;function f(){const e=localStorage.getItem("sketches");return e?JSON.parse(e):{}}let p=(new Date).getTime();function m(e,t){const n=f(),o=(new Date).getTime();o>p+1e3&&(n[e]={source:t,date:o,name:e},localStorage.setItem("sketches",JSON.stringify(n)),p=o)}function g(e){const t=f();delete t[e],localStorage.setItem("sketches",JSON.stringify(t))}const v=["open-sketch","save-sketch","generic"];function y(e,t){!function(e,t){const n=document.querySelector("dialog.popup.generic > div > p"),o=document.querySelector("dialog.popup.generic > div > div > span");n.textContent=e,o.textContent=t}(e,t);const n=document.querySelector(`dialog.popup.${v[2]}`);return n.showModal(),n}class S{vm;module;editor;console;id;selected;constructor(e="lu5-editor"){this.id=e,this.vm=null,this.module=null,this.editor=null,this.console=null}async init(){const e=document.getElementById(this.id);return this.module=await a.compile(),this.editor=new l.EditorView({doc:"function setup()\n  createWindow(400, 400);\nend\n\nfunction draw()\n  background('purple');\nend",extensions:[(0,l.lineNumbers)(),(0,l.highlightSpecialChars)(),(0,l.history)(),(0,l.drawSelection)(),l.EditorState.allowMultipleSelections.of(!0),(0,l.indentOnInput)(),l.StreamLanguage.define(d.lua),(0,l.syntaxHighlighting)(u,{fallback:!0}),l.keymap.of([...l.defaultKeymap,...l.historyKeymap,l.indentWithTab]),h.of(l.EditorState.tabSize.of(2))],parent:e}),this.console=new c.default("lu5-console",{hide_if_can:!1,resize:"vertical"}),Array.from(document.querySelectorAll('button[value="cancel"]')).forEach((e=>{e.addEventListener("click",(t=>{let n;for(n=e;!(n instanceof HTMLDialogElement);n=n.parentElement);n.close()}))})),this}static urlSafeRandomBase64String(){const e=new Uint8Array(6);window.crypto.getRandomValues(e);return btoa(String.fromCharCode(...e)).replace(/\+/g,"a").replace(/\//g,"b").replace(/=/g,"c").substring(0,8)}save(){this.selected?(m(this.selected,this.editor.state.doc.toString()),y("Success",`Saved as ${this.selected}`)):this.saveAs()}saveAs(){const e=document.querySelector(`dialog.popup.${v[1]}`);e.addEventListener("close",(()=>this.refresh(1))),e.showModal(),e.querySelector('button.formbtn[value="default"]').style["z-index"]=0,e.querySelector('button.formbtn[value="default"]').addEventListener("click",(t=>{const n=document.querySelector("input.sketch-name"),o=0===n.value.length?`sketch-${S.urlSafeRandomBase64String()}`:n.value;this.selected=o,m(this.selected,this.editor.state.doc.toString()),this.refresh(1),e.close(),y("Success",`Saved as ${o}`)}))}open(e=!0){const t=document.querySelector(`dialog.popup.${v[0]}`),n=f(),o=document.querySelector("div.sketch-selector");if(0===Object.keys(n).length)return t.close(),void y("Select Sketch","No saved sketches...");for(const e in n){const t=n[e],i=document.createElement("div");i.classList.add("saved-sketch","flex","gap-4"),i.classList.contains("selected")&&i.classList.remove("selected"),this.selected&&e==this.selected&&i.classList.add("selected");const s=document.createElement("span");s.classList.add("text","bold"),s.textContent=e;const r=document.createElement("span");r.classList.add("text","grey");const c=new Date(t.date);r.textContent=`${c.toDateString()} at ${c.toTimeString().split(" ")[0]}`;const a=document.createElement("div");a.classList.add("flex-col","gap-2"),a.appendChild(s),a.appendChild(r);const l=t=>{i.addEventListener("click",l),this.selected!==e&&(this.selected=e,this.refresh(0),this.open(!1))};i.addEventListener("click",l);const d=document.createElement("button");d.textContent="X",d.style.cssText="\n                padding: 0.45rem;\n                color: var(--white);\n                background-color: var(--primary);\n                z-index: 5;\n            ";const u=t=>{t.stopImmediatePropagation(),d.removeEventListener("click",u),e==this.selected&&(this.selected=void 0),g(e),this.refresh(0),this.open(!1)};d.addEventListener("click",u),i.appendChild(a),i.appendChild(d),o.appendChild(i)}e&&(t.showModal(),t.querySelector('button.formbtn[value="default"]').addEventListener("click",(e=>{if(!this.selected)return;const n=f(),{source:o}=n[this.selected];this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:o}}),this.refresh(0),t.close()})),t.addEventListener("close",(()=>{this.refresh(0)})))}openSketch(){if(!this.selected)return;const e=f(),{source:t}=e[this.selected];this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:t}}),this.refresh(0);document.querySelector(`dialog.popup.${v[0]}`).close()}refresh(e){if(v[e])switch(e){case 0:document.querySelector("div.sketch-selector").innerHTML="";break;case 1:document.querySelector("input.sketch-name").value="";break}}closeDialog(e){this.refresh(e);document.querySelector("dialog.popup"+(e?`.${e}`:"")).close()}async run(){if(!this.editor||!this.module||!this.console)return;const e=this.editor.state.doc.toString();return this.vm&&await this.stop(),this.vm=await a.instantiate(this.module).then((e=>e.setCanvas("lu5-sketch"))).then((e=>e.attach(1,this.console))).then((e=>e.attach(2,this.console))),this.vm?await this.vm.execute(e):void 0}async stop(){if(this.vm)return this.vm.loop=!1,await this.vm.clear().reset(),this.vm=null,this}}t.default=S},156:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(43)),s=n(839);window.onload=()=>{window.editor=new i.default,window.editor.init(),window.run=function(){window.editor.run()},window.stop=function(){window.editor.stop()},(0,s.init_panes)()}},129:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lua=t.builtinTag=void 0;const o=n(386);function i(e){return new RegExp("^(?:"+e.join("|")+")$","i")}var s=i(["setup","draw","circle","rect","square","ellipse","arc","triangle","quad","beginShape","vertex","endShape","createWindow","width","height","fill","noFill","stroke","noStroke","text","textSize","textAlign"]),r=i(["and","break","elseif","false","nil","not","or","return","true","function","end","if","then","else","do","while","repeat","until","for","in","local"]),c=i(["function","if","repeat","do","\\(","{"]),a=i(["end","until","\\)","}"]),l=new RegExp("^(?:"+["end","until","\\)","}","else","elseif"].join("|")+")","i");function d(e){for(var t=0;e.eat("=");)++t;return e.eat("["),t}function u(e,t){var n,o=e.next();return"-"==o&&e.eat("-")?e.eat("[")&&e.eat("[")?(t.cur=h(d(e),"comment"))(e,t):(e.skipToEnd(),"comment"):'"'==o||"'"==o?(t.cur=(n=o,function(e,t){for(var o,i=!1;null!=(o=e.next())&&(o!=n||i);)i=!i&&"\\"==o;return i||(t.cur=u),"string"}))(e,t):"["==o&&/[\[=]/.test(e.peek())?(t.cur=h(d(e),"string"))(e,t):/\d/.test(o)?(e.eatWhile(/[\w.%]/),"number"):/[\w_]/.test(o)?(e.eatWhile(/[\w\\\-_.]/),"("==e.peek()?"variableName.function":"variable"):null}function h(e,t){return function(n,o){for(var i,s=null;null!=(i=n.next());)if(null==s)"]"==i&&(s=0);else if("="==i)++s;else{if("]"==i&&s==e){o.cur=u;break}s=null}return t}}t.builtinTag=o.Tag.define(),t.lua={name:"lua",startState:function(){return{basecol:0,indentDepth:0,cur:u}},token:function(e,t){if(e.eatSpace())return null;var n=t.cur(e,t),o=e.current();return"variable"==n&&(r.test(o)&&(n="keyword"),s.test(o)&&(n="builtin")),"comment"!=n&&"string"!=n&&(c.test(o)?++t.indentDepth:a.test(o)&&--t.indentDepth),n},indent:function(e,t,n){var o=l.test(t);return e.basecol+n.unit*(e.indentDepth-(o?1:0))},languageData:{indentOnInput:/^\s*(?:end|until|else|\)|\})$/,commentTokens:{line:"--",block:{open:"--[[",close:"]]--"}}}}},839:(e,t)=>{function n(e,t){let n;const o=e.previousSibling,i=e.nextSibling;function s(s){var r={x:s.clientX-n.e.clientX,y:s.clientY-n.e.clientY};if("H"===t){r.x=Math.min(Math.max(r.x,-n.firstWidth),n.secondWidth),e.style.left=n.offsetLeft+r.x+"px";if(n.firstWidth+r.x<320)return;o.style.width=n.firstWidth+r.x+"px",i.style.width=n.secondWidth-r.x+"px"}else if("V"===t){r.y=Math.min(Math.max(r.y,-n.firstWidth),n.secondWidth);const t=n.secondWidth-r.y;if(t<72)return;e.style.top=n.offsetTop+r.y+"px";const s=n.firstWidth+r.y;o.style.height=s+"px",i.style.height=t+"px"}}e.onmousedown=function(r){n="H"===t?{e:r,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,firstWidth:o.offsetWidth,secondWidth:i.offsetWidth}:{e:r,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,firstWidth:o.offsetHeight,secondWidth:i.offsetHeight};document.onmousemove=s,document.onmouseup=()=>{document.onmousemove=document.onmouseup=null}}}Object.defineProperty(t,"__esModule",{value:!0}),t.dragElement=n,t.init_panes=function(){n(document.querySelector(".horizontal.separator"),"H"),n(document.querySelector(".vertical.separator"),"V")}},386:t=>{t.exports=e},784:e=>{e.exports=t},196:e=>{e.exports=n}},i={};(function e(t){var n=i[t];if(void 0!==n)return n.exports;var s=i[t]={exports:{}};return o[t].call(s.exports,s,s.exports,e),s.exports})(156);