import*as t from"https://matiasvlevi.github.io/lu5/assets/codemirror.min.js";import*as e from"https://unpkg.com/lu5-components@latest/dist/lu5-console.min.js";import*as i from"https://unpkg.com/lu5-wasm@latest/dist/lu5-wasm-lib.min.js";var o={43:function(t,e,i){var o=this&&this.__createBinding||(Object.create?function(t,e,i,o){void 0===o&&(o=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,o,n)}:function(t,e,i,o){void 0===o&&(o=i),t[o]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&o(e,t,i);return n(e,t),e},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=r(i(567)),u=s(i(196)),a=i(214);let d=new a.Compartment;e.default=class{vm;module;editor;console;id;constructor(t="lu5-editor"){this.id=t,this.vm=null,this.module=null,this.editor=null,this.console=null}async init(){const t=document.getElementById(this.id);return this.module=await u.compile(),this.editor=new a.EditorView({doc:"function setup()\n  createWindow(400, 400);\nend\n\nfunction draw()\n  background('purple');\nend",extensions:[(0,a.lineNumbers)(),(0,a.highlightSpecialChars)(),(0,a.history)(),(0,a.drawSelection)(),a.EditorState.allowMultipleSelections.of(!0),(0,a.indentOnInput)(),(0,a.syntaxHighlighting)(a.defaultHighlightStyle,{fallback:!0}),a.keymap.of([...a.defaultKeymap,...a.historyKeymap,a.indentWithTab]),d.of(a.EditorState.tabSize.of(2))],parent:t}),this.console=new l.default("lu5-console",{hide_if_can:!1,resize:"vertical"}),this}async run(){if(!this.editor||!this.module||!this.console)return;const t=this.editor.state.doc.toString();return this.vm&&await this.stop(),this.vm=await u.instantiate(this.module).then((t=>t.setCanvas("lu5-sketch"))).then((t=>t.attach(1,this.console))).then((t=>t.attach(2,this.console))),this.vm?await this.vm.execute(t):void 0}async stop(){if(this.vm)return this.vm.loop=!1,await this.vm.clear().reset(),this.vm=null,this}}},156:function(t,e,i){var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=o(i(43)),s=i(839);window.onload=()=>{window.editor=new n.default,window.editor.init(),window.run=function(){window.editor.run()},window.stop=function(){window.editor.stop()},(0,s.init_panes)()}},839:(t,e)=>{function i(t,e){let i;const o=t.previousSibling,n=t.nextSibling;function s(s){var r={x:s.clientX-i.e.clientX,y:s.clientY-i.e.clientY};if("H"===e){r.x=Math.min(Math.max(r.x,-i.firstWidth),i.secondWidth),t.style.left=i.offsetLeft+r.x+"px";if(i.firstWidth+r.x<320)return;o.style.width=i.firstWidth+r.x+"px",n.style.width=i.secondWidth-r.x+"px"}else if("V"===e){r.y=Math.min(Math.max(r.y,-i.firstWidth),i.secondWidth);const e=i.secondWidth-r.y;if(e<72)return;t.style.top=i.offsetTop+r.y+"px";const s=i.firstWidth+r.y;o.style.height=s+"px",n.style.height=e+"px"}}t.onmousedown=function(r){i="H"===e?{e:r,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,firstWidth:o.offsetWidth,secondWidth:n.offsetWidth}:{e:r,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,firstWidth:o.offsetHeight,secondWidth:n.offsetHeight};document.onmousemove=s,document.onmouseup=()=>{document.onmousemove=document.onmouseup=null}}}Object.defineProperty(e,"__esModule",{value:!0}),e.dragElement=i,e.init_panes=function(){i(document.querySelector(".horizontal.separator"),"H"),i(document.querySelector(".vertical.separator"),"V")}},214:e=>{e.exports=t},567:t=>{t.exports=e},196:t=>{t.exports=i}},n={};(function t(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return o[e].call(s.exports,s,s.exports,t),s.exports})(156);